# ResponseBodyEmitter ä½¿ç”¨æŒ‡å—

[![Spring](https://img.shields.io/badge/Spring-æ¡†æž¶-6DB33F?style=flat-square&logo=spring&logoColor=white)](https://spring.io/)
[![Java](https://img.shields.io/badge/Java-ç¼–ç¨‹è¯­è¨€-ED8B00?style=flat-square&logo=java&logoColor=white)](https://www.java.com/)

## ðŸ“– å‰è¨€

æœ€è¿‘åœ¨å­¦ä¹  AI Agent å¼€å‘ï¼Œåœ¨å‰åŽç«¯æ•°æ®äº¤äº’çš„æ—¶å€™é‡åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æžœä½¿ç”¨è€…å‘ AI å‘é€ä¸€æ®µæç¤ºè¯ï¼ŒAI é€šå¸¸çš„å¤„ç†å®Œæ¯•çš„è€—æ—¶ä¼šæ¯”è¾ƒé•¿ï¼Œå› ä¸ºä»–æ˜¯æµå¼è¾“å‡ºçš„ï¼Œè¿™æ—¶å€™ï¼Œå‰ç«¯åªèƒ½é™æ‚„æ‚„çš„ç­‰å¾…ï¼Œç»™ä½¿ç”¨è€…å¸¦æ¥çš„ä½“éªŒå°±ä¸æ˜¯å¾ˆç¾Žå¦™ã€‚æ¯•ç«Ÿï¼Œåœ¨ä½ è®²å®Œè¯ä¹‹åŽï¼Œå¯¹é¢é™æ‚„æ‚„çš„ï¼Œè·Ÿæ­»äº†ä¸€æ ·ï¼Œè‚¯å®šä¸æ˜¯å¾ˆç¾Žå¦™äº†ï¼Œæˆ‘ä»¬éœ€è¦ç›¸å¯¹åº”çš„æµå¼äº¤äº’æ–¹å¼æ¥è§£å†³è¿™ä¸€ç‚¹ï¼ŒåŽç«¯çš„ AI äº§ç”Ÿä¸€ç‚¹å†…å®¹å°±å‘å‰ç«¯è¾“å‡ºä¸€ç‚¹å†…å®¹ï¼Œè¿™æ ·å°±æ¯”è¾ƒç¾Žå¦™äº†ã€‚

---

## ðŸŽ¯ è§£å†³é—®é¢˜

é€‚åˆè€—æ—¶æ¯”è¾ƒé•¿çš„ä»»åŠ¡æˆ–è€…æ˜¯ä¼šæŒç»­è¾“å‡ºå†…å®¹çš„ä»»åŠ¡ï¼Œæ¯”å¦‚ä¸‹è½½è¿›åº¦ã€å®žæ—¶æ—¥å¿—ã€å¤§æ•°æ®é‡åˆ†ç‰‡åŠ è½½ç­‰ç­‰ã€‚

**ResponseBodyEmitter**ï¼šæ˜¯ Spring MVCï¼ˆä»Ž 4.2 ç‰ˆæœ¬å¼•å…¥ï¼‰æä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºŽ**å¼‚æ­¥ã€åˆ†æ®µåœ°å‘å®¢æˆ·ç«¯å‘é€æ•°æ®**

**ç‰¹ç‚¹ï¼š**
- **ä¸é˜»å¡žæœåŠ¡å™¨çº¿ç¨‹**ï¼šåœ¨æ•°æ®å‡†å¤‡å¥½ä¹‹å‰ï¼Œé‡Šæ”¾å®¹å™¨çº¿ç¨‹åŽ»å¤„ç†å…¶ä»–è¯·æ±‚
- **æµå¼è¾“å‡º**ï¼šæ•°æ®äº§ç”Ÿä¸€ç‚¹ï¼Œå°±å‘ç»™å®¢æˆ·ç«¯ä¸€ç‚¹

éžå¸¸ç¾Žå¦™...

---

## ðŸ’¡ ç®€å•ç¤ºä¾‹

```java
@GetMapping("/stream")
public ResponseBodyEmitter handle() {
    // 1. åˆ›å»ºä¸€ä¸ªå‘å°„å™¨ï¼ˆå¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼‰
    ResponseBodyEmitter emitter = new ResponseBodyEmitter();

    // 2. å¯åŠ¨å¼‚æ­¥çº¿ç¨‹å‘é€æ•°æ®
    Executors.newSingleThreadExecutor().execute(() -> {
        try {
            for (int i = 0; i < 5; i++) {
                // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
                Thread.sleep(1000); 
                // å‘é€æ•°æ®
                emitter.send("ç¬¬ " + i + " æ‰¹æ•°æ®åŒ…\n");
            }
            // 3. å…¨éƒ¨å‘é€å®Œæˆ
            emitter.complete();
        } catch (Exception e) {
            emitter.completeWithError(e);
        }
    });

    return emitter;
}
```

å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å¯ä»¥ç›´æŽ¥è¿”å›ž `ResponseBodyEmitter` å¯¹è±¡ï¼Œç„¶åŽï¼ŒæŽ¥å—è€…å’Œå‘é€è€…ä¹‹é—´åƒæ˜¯å»ºç«‹äº†ä¸€ä¸ªç®¡é“ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥è®©å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨åˆ›å»ºå¥½çš„è¿™ä¸ªå¯¹è±¡å¯ä»¥å‘é€æ•°æ®ï¼Œå¦ä¸€ç«¯ä¼šé€æ­¥çš„æŽ¥æ”¶æ•°æ®ï¼Œç›´åˆ°é€šé“å…³é—­ã€‚

---

## ðŸ“š åŸºæœ¬ç”¨æ³•

**æ–‡æ¡£è¯¦è§ï¼š** [ResponseBodyEmitter (Spring Framework 7.0.3 API)](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/mvc/method/annotation/ResponseBodyEmitter.html)

### æž„é€ æ–¹æ³•

- `ResponseBodyEmitter()` - å¸¸ç”¨
- `ResponseBodyEmitter(Long timeout)` - è®¾ç½®è¶…æ—¶æ—¶é—´

### å¸¸ç”¨æ–¹æ³•

- `send(Object data)` - å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œå¯ä»¥å¤šæ¬¡è°ƒç”¨
- `complete()` - ç»“æŸå“åº”æµï¼Œè¡¨ç¤ºæ•°æ®å‘é€å®Œæ¯•
- `onTimeout(Runnable callback)` - è®¾ç½®è¶…æ—¶å›žè°ƒå‡½æ•°
- `onCompletion(Runnable callback)` - è®¾ç½®å®Œæˆå›žè°ƒå‡½æ•°

---

## ðŸ”§ å·¥ä½œåŽŸç†

1. **æŽ§åˆ¶å™¨è¿”å›žå¯¹è±¡**ï¼šController ä¸å†è¿”å›žæ™®é€šçš„ `String` æˆ– `ResponseEntity`ï¼Œè€Œæ˜¯ç›´æŽ¥è¿”å›ž `ResponseBodyEmitter` å®žä¾‹

2. **å¥æŸ„æŒæœ‰**ï¼šSpring ä¼šä¿æŒè¿™ä¸ª HTTP è¿žæŽ¥å¼€å¯

3. **å¼‚æ­¥å‘é€**ï¼šä½ å¯ä»¥æŠŠè¿™ä¸ª `emitter` ä¸¢ç»™å¦ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹ã€‚é‚£ä¸ªçº¿ç¨‹åªè¦è°ƒç”¨ `emitter.send(data)`ï¼Œæ•°æ®å°±ä¼šè¢«æŽ¨é€åˆ°å®¢æˆ·ç«¯

4. **å®Œæˆæˆ–è¶…æ—¶**ï¼šè°ƒç”¨ `emitter.complete()` å…³é—­è¿žæŽ¥ï¼Œæˆ–è€…å› ä¸ºè¶…æ—¶è‡ªåŠ¨æ–­å¼€

---

## âš ï¸ æ³¨æ„äº‹é¡¹

- **èµ„æºé‡Šæ”¾**ï¼šæ³¨æ„ç”¨å®Œå°±ä¸¢æŽ‰æˆ–è€…ç›´æŽ¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶å°±å…³é—­
- **çº¿ç¨‹å®‰å…¨**ï¼š`send()` æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„

---

## ðŸ”„ ç›¸å…³å·¥å…·å¯¹æ¯”

åœ¨ Spring ä¸­ï¼Œä½ å¯èƒ½è¿˜ä¼šçœ‹åˆ°å¦å¤–ä¸¤ä¸ªé•¿å¾—å¾ˆåƒçš„ä¸œè¥¿ï¼š

| å·¥å…· | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **ResponseBodyEmitter** | é€šç”¨çš„å¼‚æ­¥æµ | çµæ´»åœ°å‘é€ä»»ä½•å¯¹è±¡ï¼ŒSpring ä¼šç”¨ HttpMessageConverter è½¬æˆ JSON ç­‰ |
| **SseEmitter** | ç»§æ‰¿è‡ªä¸Šé¢é‚£ä½ï¼Œä¸“é—¨ç”¨äºŽ **Server-Sent Events (SSE)** | æµè§ˆå™¨ç«¯çš„å®žæ—¶æŽ¨é€ï¼ˆç±»ä¼¼å•å‘ WebSocketï¼‰ |
| **StreamingResponseBody** | æ€§èƒ½æ›´é«˜ï¼Œç›´æŽ¥æ“ä½œ `OutputStream` | é€‚åˆå‘é€å¤§æ–‡ä»¶æˆ–çº¯æ–‡æœ¬æµ |

---

## ðŸ‘‹ æ€»ç»“

ResponseBodyEmitter æ˜¯ä¸€ä¸ªéžå¸¸å®žç”¨çš„å·¥å…·ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦æµå¼è¾“å‡ºçš„åœºæ™¯ã€‚é€šè¿‡å¼‚æ­¥å‘é€æ•°æ®ï¼Œå¯ä»¥å¤§å¤§æå‡ç”¨æˆ·ä½“éªŒï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…çš„å°´å°¬ã€‚

æŽ°æŽ°~
